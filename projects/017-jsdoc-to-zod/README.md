# jsdoc-to-zod

[![NPM version](https://img.shields.io/npm/v/jsdoc-to-zod.svg)](https://www.npmjs.com/package/jsdoc-to-zod)
[![License](https://img.shields.io/npm/l/jsdoc-to-zod.svg)](https://github.com/your-username/jsdoc-to-zod/blob/main/LICENSE)

A CLI tool and library that parses JSDoc type annotations from your JavaScript files and generates corresponding Zod schemas. Keep your runtime validation in sync with your static documentation, effortlessly.

## Description

This project provides a bridge between your documentation and your runtime validation logic. By parsing standard JSDoc comments (`@param`, `@typedef`, `@returns`), it automatically generates Zod schemas that you can use for validating API inputs, function arguments, or any other data structures.

This ensures that your validation logic never drifts from your documented types, reducing bugs and improving developer confidence.

## Features

-   **AST-Powered Parsing**: Accurately parses JSDoc from JavaScript source code using Acorn.
-   **Broad JSDoc Support**: Handles `@param`, `@returns`, `@typedef`, and `@property` tags.
-   **Rich Type Conversion**: Supports primitives (`string`, `number`), complex types (`Object`, `string[]`, `Array<string>`), union types (`string|number`), and optional parameters (`[name]`).
-   **Flexible CLI**: Process single files or entire directories using glob patterns.
-   **Multiple Output Options**: Print generated schemas to standard output or write them to a specified directory.
-   **Programmatic API**: Integrate schema generation directly into your build scripts or other tools.

## Installation

You can use `jsdoc-to-zod` as a local development dependency.

```bash
npm install --save-dev jsdoc-to-zod
```

Or, for global CLI access:

```bash
npm install -g jsdoc-to-zod
```

## Usage

### CLI

The CLI is the most common way to use `jsdoc-to-zod`. You can point it at files or use glob patterns.

**Generate schemas and print to console:**

```bash
npx jsdoc-to-zod "src/**/*.js"
```

**Generate schemas and write to a directory:**

This command will process all `.js` files in the `src` directory and create corresponding `.schema.js` files in the `dist/schemas` directory.

```bash
npx jsdoc-to-zod "src/**/*.js" --output dist/schemas
```

**CLI Options:**

-   `<files...>`: (Required) One or more files or glob patterns to process.
-   `--output, -o`: Specify an output directory. If omitted, output is printed to `stdout`.
-   `--help, -h`: Show help information.
-   `--version, -v`: Show the current version.

### Programmatic API

You can also use `jsdoc-to-zod` as a library in your own scripts.

```javascript
import { generate, generateFromFile } from 'jsdoc-to-zod';

const jsCode = `
/**
 * Creates a new user.
 * @param {string} name - The user's full name.
 * @param {number} [age] - The user's age (optional).
 */
function createUser(name, age) {
  // ...
}`;

// Generate from a string
const schemaFromString = await generate(jsCode);
console.log(schemaFromString);

// Generate from a file
const schemaFromFile = await generateFromFile('./path/to/your/file.js');
console.log(schemaFromFile);
```

## Examples

### 1. Function Parameters

Given a source file `src/users.js`:

```javascript
// src/users.js

/**
 * Creates a new user profile.
 * @param {string} username - The desired username.
 * @param {string} email - The user's email address.
 * @param {number} [age] - The user's age, must be 18 or older.
 * @param {string[]} roles - A list of roles to assign.
 */
export function createUser(username, email, age, roles) {
  // function implementation...
}
```

Run the generator:

```bash
npx jsdoc-to-zod src/users.js
```

**Output:**

```javascript
/**
 * This file was generated by jsdoc-to-zod.
 * Do not make changes to this file directly.
 */

import { z } from 'zod';

// Generated from createUser
export const createUserSchema = z.object({
  username: z.string().describe('The desired username.'),
  email: z.string().describe('The user\'s email address.'),
  age: z.number().optional().describe('The user\'s age, must be 18 or older.'),
  roles: z.array(z.string()).describe('A list of roles to assign.')
});
```

### 2. Complex Type with `@typedef`

Given a source file `src/types.js`:

```javascript
// src/types.js

/**
 * @typedef {object} Product
 * @property {string} id - The unique product ID.
 * @property {string} name - The name of the product.
 * @property {number} price - The price in cents.
 * @property {boolean} [inStock=true] - Availability status.
 */
export const Product = {};
```

Run the generator:

```bash
npx jsdoc-to-zod src/types.js
```

**Output:**

```javascript
/**
 * This file was generated by jsdoc-to-zod.
 * Do not make changes to this file directly.
 */

import { z } from 'zod';

// Generated from Product
export const productSchema = z.object({
  id: z.string().describe('The unique product ID.'),
  name: z.string().describe('The name of the product.'),
  price: z.number().describe('The price in cents.'),
  inStock: z.boolean().optional().describe('Availability status.')
});
```

## License

This project is licensed under the MIT License. See the [LICENSE](LICENSE) file for details.